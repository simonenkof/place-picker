openapi: 3.1.0
info:
  title: Server API
  version: 0.1.0
  description: API для взаимодействия с сервисом Place Picker.

  contact:
    name: Фёдор Симоненко
    email: simonenko.f.a@gmail.com

  license:
    url: https://mit-license.org
    name: MIT

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

paths:
  /api/auth/login:
    post:
      tags:
        - Авторизация
      security: []
      operationId: login
      summary: Авторизация
      description: Возвращает пару токенов для авторизации и идентификатор пользователя.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: './components.yaml#/components/schemas/login_payload'
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                $ref: './components.yaml#/components/schemas/tokens'
        '400':
          $ref: './responses.yaml#/responses/400'
        '401':
          $ref: './responses.yaml#/responses/401'
        '500':
          $ref: './responses.yaml#/responses/500'

  /api/auth/refresh:
    post:
      tags:
        - Авторизация
      security: []
      operationId: refreshToken
      summary: Обновление токена
      description: Обновляет токен доступа.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: './components.yaml#/components/schemas/refresh_payload'
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                $ref: './components.yaml#/components/schemas/tokens'
        '400':
          $ref: './responses.yaml#/responses/400'
        '401':
          $ref: './responses.yaml#/responses/401'
        '500':
          $ref: './responses.yaml#/responses/500'

  /api/auth/register:
    post:
      tags:
        - Авторизация
      security: []
      operationId: registerUser
      summary: Регистрация пользователя
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: './components.yaml#/components/schemas/register_payload'
      responses:
        '201':
          $ref: './responses.yaml#/responses/201'
        '400':
          $ref: './responses.yaml#/responses/400'
        '409':
          $ref: './responses.yaml#/responses/409'
        '500':
          $ref: './responses.yaml#/responses/500'

  /api/private/desks:
    get:
      tags:
        - Столы
      security:
        - BearerAuth: []
      operationId: getDesks
      summary: Список столов
      description: Возвращает список доступных столов.
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                type: object
                $ref: './components.yaml#/components/schemas/desks_payload'
        '400':
          $ref: './responses.yaml#/responses/400'
        '404':
          $ref: './responses.yaml#/responses/404'
        '500':
          $ref: './responses.yaml#/responses/500'

  /api/private/desks/{id}:
    put:
      tags:
        - Столы
      security:
        - BearerAuth: []
      operationId: changeDesk
      summary: Изменить стол
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            description: Идентификатор стола
            example: qwe-qw32rfds-qwef
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  description: Имя стола
                  example: A-01
              required:
                - name
      responses:
        '200':
          $ref: './responses.yaml#/responses/200'
        '400':
          $ref: './responses.yaml#/responses/400'
        '404':
          $ref: './responses.yaml#/responses/404'
        '409':
          $ref: './responses.yaml#/responses/409'
        '500':
          $ref: './responses.yaml#/responses/500'

    delete:
      tags:
        - Столы
      security:
        - BearerAuth: []
      operationId: deleteDesk
      summary: Удалить стол
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            description: Идентификатор стола
            example: qwe-qw32rfds-qwef
      responses:
        '200':
          $ref: './responses.yaml#/responses/200'
        '400':
          $ref: './responses.yaml#/responses/400'
        '404':
          $ref: './responses.yaml#/responses/404'
        '500':
          $ref: './responses.yaml#/responses/500'

  /api/private/desks/load:
    post:
      tags:
        - Столы
      security:
        - BearerAuth: []
      operationId: loadDesk
      summary: Добавить столы
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                desks:
                  type: array
                  items:
                    type: object
                    properties:
                      name:
                        type: string
                        description: Имя стола
                        example: A-01
      responses:
        '201':
          $ref: './responses.yaml#/responses/201'
        '400':
          $ref: './responses.yaml#/responses/400'
        '401':
          $ref: './responses.yaml#/responses/401'
        '409':
          $ref: './responses.yaml#/responses/409'
        '500':
          $ref: './responses.yaml#/responses/500'

  /api/private/reservation:
    get:
      tags:
        - Резерв
      security:
        - BearerAuth: []
      operationId: getReservation
      summary: Список броней пользователя
      description: Возвращает список броней пользователя.
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                $ref: './components.yaml#/components/schemas/reservations_payload'
        '400':
          $ref: './responses.yaml#/responses/400'
        '401':
          $ref: './responses.yaml#/responses/401'
        '500':
          $ref: './responses.yaml#/responses/500'

    post:
      tags:
        - Резерв
      security:
        - BearerAuth: []
      operationId: createReservation
      summary: Создает бронь стола
      description: Создает бронь стола для пользователя.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                deskId:
                  type: string
                  description: Идентификатор стола
                  example: qwe-qw32rfds-qwef
                dateFrom:
                  type: string
                  description: Время начала брони
                  example: '09:00 01.05.2025'
                dateTo:
                  type: string
                  description: Время завершения брони
                  example: '18:00 01.05.2025'

      responses:
        '201':
          $ref: './responses.yaml#/responses/201'
        '400':
          $ref: './responses.yaml#/responses/400'
        '401':
          $ref: './responses.yaml#/responses/401'
        '409':
          $ref: './responses.yaml#/responses/409'
        '500':
          $ref: './responses.yaml#/responses/500'

  /api/private/reservation/{id}:
    delete:
      tags:
        - Резерв
      security:
        - BearerAuth: []
      operationId: deleteReservation
      summary: Удаляет бронь пользователя
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
            description: Идентификатор брони
            example: qwe-qw32rfds-qwef
      responses:
        '200':
          $ref: './responses.yaml#/responses/200'
        '400':
          $ref: './responses.yaml#/responses/400'
        '401':
          $ref: './responses.yaml#/responses/401'
        '404':
          $ref: './responses.yaml#/responses/404'
        '500':
          $ref: './responses.yaml#/responses/500'

  /api/private/reservation/all:
    delete:
      tags:
        - Резерв
      security:
        - BearerAuth: []
      operationId: deleteAllUserReservations
      summary: Удалить все брони пользователя
      description: Удаляет все брони текущего авторизованного пользователя.
      responses:
        '200':
          $ref: './responses.yaml#/responses/200'
        '401':
          $ref: './responses.yaml#/responses/401'
        '404':
          $ref: './responses.yaml#/responses/404'
        '500':
          $ref: './responses.yaml#/responses/500'

  /api/auth/verify:
    get:
      tags:
        - Авторизация
      security: []
      operationId: verifyEmail
      summary: Подтверждение email
      description: Подтверждает email пользователя по токену из письма.
      parameters:
        - name: token
          in: query
          required: true
          schema:
            type: string
            description: Токен подтверждения из письма
            example: abc123-def456-ghi789
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: email verified successfully
        '400':
          $ref: './responses.yaml#/responses/400'
        '500':
          $ref: './responses.yaml#/responses/500'

  /api/private/user/me:
    get:
      tags:
        - Пользователь
      security:
        - BearerAuth: []
      operationId: getCurrentUser
      summary: Получить текущего пользователя
      description: Возвращает информацию о текущем авторизованном пользователе.
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                $ref: './components.yaml#/components/schemas/user'
        '401':
          $ref: './responses.yaml#/responses/401'
        '404':
          $ref: './responses.yaml#/responses/404'
        '500':
          $ref: './responses.yaml#/responses/500'
